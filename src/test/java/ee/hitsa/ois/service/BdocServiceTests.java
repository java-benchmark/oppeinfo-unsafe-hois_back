package ee.hitsa.ois.service;

import org.junit.Assert;
import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
import org.springframework.http.MediaType;
import org.springframework.test.context.junit4.SpringRunner;
import org.springframework.util.StringUtils;

import ee.hitsa.ois.bdoc.UnsignedBdocContainer;

@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = WebEnvironment.MOCK)
public class BdocServiceTests {

    @Autowired
    private BdocService bdocService;
    private static final String certInHex = "308206823082046AA003020102021038302EBD3A0BDBA158CA7FC5C3553571300D06092A864886F70D01010B05003063310B300906035504061302454531223020060355040A0C19415320536572746966697473656572696D69736B65736B75733117301506035504610C0E4E545245452D31303734373031333117301506035504030C0E4553544549442D534B2032303135301E170D3137303331363132303632395A170D3232303331353231353935395A30819A310B3009060355040613024545310F300D060355040A0C06455354454944311A3018060355040B0C116469676974616C207369676E61747572653124302206035504030C1B505555535455534D41412C5349494D2C33383930333137363533333113301106035504040C0A505555535455534D4141310D300B060355042A0C045349494D311430120603550405130B333839303331373635333330820122300D06092A864886F70D01010105000382010F003082010A02820101009CBF83DA0CD90573CCA2778F9427F2B37D6274152B227A8EF7469BCABA8BC06BFA91218A99FB8CAFDC35FE3FF9ECB2BB7EC87BA4CC9C4A287C015E9EC1A547FD579A08B2AC21C25771D8F2DF273EED2B8370338D4BF59E41D60024A3B72D2DB9E122520C530642556F897AD5EF363EBD3ACD62544DCB0ADA1D9147E08422CA3A987989069D68436D5A47CB46C0B1728E2E913A4AE9B9949CFD2C3F4E51D880CB4B89445411F239073D4F6931BC2F1BBAE811DF4D998E4E4FE276CA7FA4F62CB5C2572A938612EA56CAAC3803B5AF73BC5F2BB2F0F17A3502DB1CA8363F4032545A9A665C922BA23DF26F27A955209770BB30F4B0E0518DD2CC49226AF689BB950203010001A38201F8308201F430090603551D1304023000300E0603551D0F0101FF04040302064030540603551D20044D304B303E06092B06010401CE1F01013031302F06082B06010505070201162368747470733A2F2F7777772E736B2E65652F7265706F7369746F6F7269756D2F4350533009060704008BEC400102301D0603551D0E04160414E8198BD5E67556441E83A708C79661D91FAB5DCD30818A06082B06010505070103047E307C3008060604008E4601013008060604008E4601043051060604008E46010530473045163F68747470733A2F2F736B2E65652F656E2F7265706F7369746F72792F636F6E646974696F6E732D666F722D7573652D6F662D6365727469666963617465732F1302454E3013060604008E4601063009060704008E46010601301F0603551D23041830168014B3AB88BC99D562A4852A08CDB41D723B83724751307606082B06010505070101046A3068302706082B06010505073001861B687474703A2F2F6169612E736B2E65652F65737465696432303135303D06082B06010505073002863168747470733A2F2F736B2E65652F75706C6F61642F66696C65732F4553544549442D534B5F323031352E6465722E637274303C0603551D1F043530333031A02FA02D862B687474703A2F2F7777772E736B2E65652F63726C732F6573746569642F657374656964323031352E63726C300D06092A864886F70D01010B050003820201009EDC386CFA05AAAF51AFB17469B06D671E985CFDB828DA9ED1409B40BF90A9155C23EEA0769A037397FBA655CD0526EAD2A46A492448B809CECF296E9BECF4F606CC728E56CA57CD5E7504565D3CE83BD89985AE8E65A08C57A1241AD2A1A557967CA1C80BE1BB5119386E82631AA4F58D2D53421CEDAED4037E5A73B978B8527947745D425DD82E3879A37E2317F4E4DFED806F20CAD319CD17A0610B4D69162D36860DDD6BB3EBEA254DA0869CBA69749A39B5A19D9BBD36742257E2E7FCDB571FA17055CB1819720C518D84A1C800D413FF655DA691089714F5BA065DC3B47A4529780780588CDE3BF23F31C0698F64B03BD3FC619D96D0162E585F4A6B18B90355E8EACE9D6952D6A3CFE243F1AE531D45B8C84EF54B9E807F03FEC446AE1190292B55D5AF5D1706EA0BB80DD3AB960D0A607BDFE24B4CF366C0A915F2004C87B8BDBAE66940711D19EECFF43613C0EAD710E276698E3C66F449C4E8510F9BFF76EC4DD6F048915FB8AFF5DF60569D5A332B27B85C1CC45EEDF1677D2BBCA1EC104BB9B055B46016350627ADA1D63C06CBC674C0E7550BE8BBB4FB72557E0D39C78148A02A36CEB73FC7ABE6B9C754F9A7B34486EB53921062DC78F4D48CEC15CEE38EDFB7961066992CA94141463E5644A0F89B5B9082AC27F3DC61403A38A1E1EF373E52BA9FD7CBBE6D3DB843802A12CF9C0C3F002AAFF82DC66B2D5A";

    @Test
    public void createUnsignedBdocContainer() {
        UnsignedBdocContainer unsignedBdocContainer =  bdocService.createUnsignedBdocContainer("test.pdf",
                MediaType.APPLICATION_PDF_VALUE, "test".getBytes(), certInHex);
        Assert.assertNotNull(unsignedBdocContainer.getContainer());
        Assert.assertNotNull(unsignedBdocContainer.getDataToSign());
        Assert.assertFalse(StringUtils.isEmpty(unsignedBdocContainer.getDigestToSign()));
        Assert.assertTrue(unsignedBdocContainer.getContainer().getType() == "BDOC");
    }


}
